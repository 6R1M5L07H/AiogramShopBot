# ============================================================================
# AiogramShopBot Production Configuration Template
# ============================================================================
#
# HOW TO USE:
# 1. Copy this file: cp .env.prod.template .env
# 2. Fill in all values (replace empty strings and placeholders)
# 3. Never commit .env to git (it's in .gitignore)
# 4. Set strict file permissions: chmod 600 .env
# 5. Consider using secrets management (Vault, AWS Secrets Manager, etc.)
#
# This template is optimized for PRODUCTION DEPLOYMENT with:
# - External IP/domain for Telegram webhooks (no ngrok)
# - Strict rate limits for abuse prevention
# - INFO logging (clean logs, no SQL queries)
# - Database encryption enabled
# - All security features enabled
# - Automated backups
#
# For local development, use .env.dev.template instead.
#
# ============================================================================

# ----------------------------------------------------------------------------
# TELEGRAM BOT CONFIGURATION
# ----------------------------------------------------------------------------

# Bot API token from @BotFather
# Example: 1234567890:ABCdefGHIjklMNOpqrsTUVwxyz1234567890
TOKEN=

# Comma-separated list of Telegram user IDs with admin privileges
# Find your ID via @userinfobot
# Example: 123456789,987654321
#
#  WARNING: PRODUCTION SECURITY:
# - Set file permissions: chmod 600 .env (owner read/write only)
# - Never commit .env to version control (already in .gitignore)
# - Use secrets management in production (Vault, AWS Secrets Manager)
# - Rotate IDs immediately if .env file is compromised
# - Limit admin access to essential personnel only
ADMIN_ID_LIST=

# Enable notifications to admins when new users register
# Production: true (monitor new user registrations)
# Options: true | false
NOTIFY_ADMINS_NEW_USER=true

# Support contact link shown to users (Telegram username or group)
# Example: https://t.me/your_support_bot
SUPPORT_LINK=

# ----------------------------------------------------------------------------
# WEBHOOK CONFIGURATION
# ----------------------------------------------------------------------------

# Webhook path for Telegram updates
WEBHOOK_PATH=/

# Host address for the web application
# Production: Use your domain or server IP
# Example: bot.yourdomain.com or 203.0.113.42
WEBAPP_HOST=

# Port for the web application (internal container port)
# IMPORTANT: This is the port the bot listens on INSIDE the container
# With Caddy/nginx reverse proxy (default docker-compose setup):
#   - Caddy listens on port 443 (external HTTPS)
#   - Caddy forwards to bot:5000 (internal)
#   - So WEBAPP_PORT must be 5000 (NOT 443)
# Without reverse proxy (direct access):
#   - Set to 443 and expose port 443 in docker-compose.yml
WEBAPP_PORT=5000

# Secret token for webhook authentication (generate random string)
# Production: Use strong random token (minimum 32 characters)
# Generate with: openssl rand -hex 32
# Example: 1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3
WEBHOOK_SECRET_TOKEN=

# ----------------------------------------------------------------------------
# RUNTIME ENVIRONMENT
# ----------------------------------------------------------------------------

# Runtime environment mode
# PROD: Uses external IP from sslipio (no ngrok)
RUNTIME_ENVIRONMENT=PROD

# Ngrok authentication token
# Production: NOT NEEDED (leave empty)
NGROK_TOKEN=

# ----------------------------------------------------------------------------
# DATABASE CONFIGURATION
# ----------------------------------------------------------------------------

# SQLite database filename
DB_NAME=database.db

# Database encryption
# Production: ENABLED for security (encrypts database at rest)
# Options: true | false
# Recommended: true
DB_ENCRYPTION=true

# Database password (REQUIRED if DB_ENCRYPTION=true)
# Production: Use strong random password (minimum 20 characters)
# Generate with: openssl rand -base64 32
# Example: xY3kL9mN2pQ5rS7tU1vW4zA6bC8dE0fG2hI4jK6lM8nO0pR2sT4uV6wX8yZ0aB2cD
DB_PASS=

# ----------------------------------------------------------------------------
# REDIS CONFIGURATION
# ----------------------------------------------------------------------------

# Redis server hostname
# Production: Your Redis server address (localhost, IP, or service name)
# Docker: redis (service name in docker-compose)
# External: redis.yourdomain.com
REDIS_HOST=localhost

# Redis authentication password
# Production: REQUIRED for security
# Generate with: openssl rand -base64 32
# Example: aB3cD5eF7gH9iJ1kL3mN5oP7qR9sT1uV3wX5yZ7aB9cD1eF3gH5iJ7kL9mN1oP3qR5
REDIS_PASSWORD=

# ----------------------------------------------------------------------------
# BOT BEHAVIOR CONFIGURATION
# ----------------------------------------------------------------------------

# Number of items per page in paginated lists
# Recommended: 5-10 for optimal UX
PAGE_ENTRIES=8

# Bot language for localization
# Options: en (English) | de (German)
BOT_LANGUAGE=en

# Multi-bot mode (allows multiple bot instances)
# Production: false (unless you need multi-bot setup)
MULTIBOT=false

# Fiat currency for prices
# Options: USD | EUR | GBP
CURRENCY=USD

# ----------------------------------------------------------------------------
# PAYMENT SYSTEM (KryptoExpress)
# ----------------------------------------------------------------------------

# KryptoExpress API Key
# Production: Use your production API key
KRYPTO_EXPRESS_API_KEY=

# KryptoExpress API URL
# Production: https://kryptoexpress.pro/api
KRYPTO_EXPRESS_API_URL=https://kryptoexpress.pro/api

# KryptoExpress API Secret for webhook verification (HMAC-SHA512)
# Production: Generate strong secret (minimum 32 characters)
# Generate with: openssl rand -hex 32
# Example: abc123def456789012345678901234567890abcdef1234567890abcdef123456
KRYPTO_EXPRESS_API_SECRET=

# ----------------------------------------------------------------------------
# ORDER & INVOICE SYSTEM
# ----------------------------------------------------------------------------

# Order timeout in minutes (how long payment window stays open)
# Production: Balance between user convenience and stock locking
# Recommended: 30 minutes
ORDER_TIMEOUT_MINUTES=30

# Grace period for free order cancellation (minutes)
# Production: Short enough to discourage abuse, long enough for mistakes
# Recommended: 5 minutes
ORDER_CANCEL_GRACE_PERIOD_MINUTES=5

# Payment status check interval in seconds
# Production: Balance between responsiveness and server load
# Recommended: 60 seconds
PAYMENT_CHECK_INTERVAL_SECONDS=60

# ----------------------------------------------------------------------------
# PAYMENT VALIDATION SYSTEM
# ----------------------------------------------------------------------------

# Overpayment tolerance percentage
PAYMENT_TOLERANCE_OVERPAYMENT_PERCENT=0.1

# Enable underpayment retry
PAYMENT_UNDERPAYMENT_RETRY_ENABLED=true

# Timeout extension for underpayment retry
PAYMENT_UNDERPAYMENT_RETRY_TIMEOUT_MINUTES=30

# Penalty percentage for second underpayment
PAYMENT_UNDERPAYMENT_PENALTY_PERCENT=5

# Penalty percentage for late payment
PAYMENT_LATE_PENALTY_PERCENT=5

# ----------------------------------------------------------------------------
# DATA RETENTION & PRIVACY
# ----------------------------------------------------------------------------

# Data retention period in days (GDPR compliance)
# Production: 30 days (standard retention for financial records)
# Adjust based on local regulations
DATA_RETENTION_DAYS=30

# Referral data retention in days
# Production: Longer retention for abuse detection and analytics
REFERRAL_DATA_RETENTION_DAYS=365

# ----------------------------------------------------------------------------
# SHIPPING MANAGEMENT (for physical items)
# ----------------------------------------------------------------------------

# Encryption secret for shipping addresses (AES-256-GCM)
# Production: REQUIRED if you have physical items
# Generate with: openssl rand -hex 32
# Must be exactly 64 hex characters (32 bytes)
#
#  WARNING: CRITICAL: Back up this value with your database!
# Losing this secret = losing access to all encrypted addresses
# Example: 1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3
SHIPPING_ADDRESS_SECRET=

# PGP Encryption for Shipping Addresses (Optional - Zero-Knowledge Architecture)
# Leave empty to disable client-side PGP encryption (AES-GCM server-side fallback will be used)
# Generate keypair with: bash tools/setup_pgp_keys.sh
# PRODUCTION: Use strong passphrase-protected private key, store securely (vault/KMS)
PGP_PUBLIC_KEY_BASE64=

# Domain for Telegram Mini App (HTTPS required for Web Apps)
# PRODUCTION: Set explicitly to your production domain
# Examples: "bot.example.com" or "https://bot.example.com"
#
# How it works:
# 1. Bot startup calls initialize_webhook_config() → gets external IP (e.g., "https://203.0.113.42.sslip.io")
# 2. If BOT_DOMAIN is empty → automatically set to external IP
# 3. Bot logs: "[Init] BOT_DOMAIN auto-configured from external IP: https://203.0.113.42.sslip.io"
# 4. Mini App URLs work without manual configuration
#
# When to set manually:
# - Production with custom domain (e.g., "bot.yourdomain.com")
# - Fixed public hostname (not dynamic IP)
# - SSL certificate for specific domain
#
# Security: Auto-configuration uses HTTPS URLs (from sslipio or Caddy)
# Only leave empty if using dynamic IP addresses (sslip.io)
BOT_DOMAIN=

# ----------------------------------------------------------------------------
# STRIKE SYSTEM (automated penalty system)
# ----------------------------------------------------------------------------

# Maximum strikes before automatic ban
# Production: 3 strikes (industry standard)
MAX_STRIKES_BEFORE_BAN=3

# Exempt admins from automatic bans
# Production: false (admins should follow same rules)
# Set to true only if admins need unrestricted testing access
EXEMPT_ADMINS_FROM_BAN=false

# Minimum wallet top-up amount to unban (in EUR)
# Production: High enough to discourage abuse, low enough to be accessible
# Recommended: 50.0 EUR
UNBAN_TOP_UP_AMOUNT=50.0

# ----------------------------------------------------------------------------
# DATABASE BACKUP CONFIGURATION
# ----------------------------------------------------------------------------

# Enable automated database backups
# Production: ENABLED (critical for data safety)
# Recommended: true
DB_BACKUP_ENABLED=true

# Backup interval in hours
# Production: 4-6 backups per day
# Recommended: 6 hours
DB_BACKUP_INTERVAL_HOURS=6

# Backup retention period in days
# Production: 1 week of restore points
# Recommended: 7 days
DB_BACKUP_RETENTION_DAYS=7

# Backup directory path
# Production: Use reliable storage with external backup
# Recommended: Mounted network storage or external backup service
# Example: /var/backups/shopbot
DB_BACKUP_PATH=./backups

# ----------------------------------------------------------------------------
# RATE LIMITING (strict for production)
# ----------------------------------------------------------------------------

# Maximum orders per user per hour
# Production: Strict limit to prevent abuse and DoS
# Recommended: 5 orders per hour
MAX_ORDERS_PER_USER_PER_HOUR=5

# ----------------------------------------------------------------------------
# WEBHOOK SECURITY CONFIGURATION
# ----------------------------------------------------------------------------
#
# NOTE: Security headers are primarily relevant if you add web-based UI
# (admin dashboard, status pages, HTML content).
#
# For pure API/webhook bots, these headers provide minimal benefit.
# More critical security measures are already implemented:
#     Secret token validation
#     Rate limiting
#     Input validation
#     HTTPS/TLS
#     Secret masking in logs
#
# Enable these when adding browser-accessible features.

# Enable security headers for webhook endpoints
# Production: false for pure API bot, true if adding web UI
WEBHOOK_SECURITY_HEADERS_ENABLED=false

# Enable Content Security Policy (CSP)
# Production: false for pure API bot, true if serving HTML
WEBHOOK_CSP_ENABLED=false

# Enable HTTP Strict Transport Security (HSTS)
# Production: true if using HTTPS (recommended)
# IMPORTANT: Only enable if serving over HTTPS!
WEBHOOK_HSTS_ENABLED=true

# CORS allowed origins (comma-separated)
# Production: Add specific domains if needed for payment webhooks
# Leave empty for Telegram webhooks only
# Example: https://kryptoexpress.pro
WEBHOOK_CORS_ALLOWED_ORIGINS=

# ----------------------------------------------------------------------------
# LOGGING CONFIGURATION
# ----------------------------------------------------------------------------

# Log level for application and SQLAlchemy
# Production: INFO (clean logs, no SQL queries, good performance)
#
# Options:
#   - INFO: Recommended for production (clean, informative)
#   - WARNING: Only warnings and errors (minimal logging)
#   - ERROR: Only errors (troubleshooting issues)
#   - DEBUG: All logs + SQL queries (only for debugging issues)
#
# Recommended: INFO
LOG_LEVEL=INFO

# Number of days to keep rotated log files
# Production: Default 5 days to save disk space
# Override if you need longer retention for debugging
# LOG_RETENTION_DAYS=5

# Enable masking of sensitive data in logs
# Production: ENABLED (always mask secrets for security)
# Recommended: true
LOG_MASK_SECRETS=true
